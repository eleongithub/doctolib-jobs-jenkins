---

- name: Get the machine architecture (32 bits or 64 bits)
  shell: getconf LONG_BIT || echo "Unknown architecture"
  register: os_architecture

- name: Download jdk 32 bits Archive
  get_url:
    url: "{{ jdk_32_url }}"
    dest: "/opt/{{ jdk_tarball_name_32 }}"
    validate_certs: no
  when: "os_architecture.stdout == '{{ jdk_os_32 }}'"

- name: Decompress jdk 32 bits Archive
  unarchive:
    src: "/opt/{{ jdk_tarball_name_32 }}"
    dest: "/opt/jdk_versions/jdk1.8.0_141"
  when: "os_architecture.stdout == '{{ jdk_os_32 }}'"

- name: Delete jdk 32 bits Archive
  file:
    path: "/opt/{{ jdk_tarball_name_32 }}"
    state: absent
  when: "os_architecture.stdout == '{{ jdk_os_32 }}'"

- name: Download jdk 64 bits Archive
  get_url:
    url: "{{ jdk_64_url }}"
    dest: "/opt/{{ jdk_tarball_name_64 }}"
    validate_certs: no
  when: "os_architecture.stdout == '{{ jdk_os_64 }}'"

- name: Decompress jdk 64 bits Archive
  unarchive:
    src: "/opt/{{ jdk_tarball_name_64 }}"
    dest: "/opt/jdk_versions/jdk1.8.0_141"
  when: "os_architecture.stdout == '{{ jdk_os_64 }}'"

- name: Delete jdk 64 bits Archive
  file:
    path: "/opt/{{ jdk_tarball_name_64 }}"
    state: absent
  when: "os_architecture.stdout == '{{ jdk_os_64 }}'"

- name: Add/Update environments variables
  blockinfile:
    dest: "/etc/profile"
    insertafter: EOF
    block: |
      # Java Home
      JAVA_HOME="{{ jdk_java_home }}"
      export JAVA_HOME
      # Update PATH
      PATH=$PATH:"$JAVA_HOME/bin"
      export PATH
    state: present

- name: Relaod environments variables
  shell: . /etc/profile
